heat_template_version: 2014-10-16

description: Nginx Install

parameters:
  GitURL:
    type: string
    label: Git URL
    description: Git URl

resources:
  backend_instance:
    type: OS::Nova::Server
    properties:
      image: Ubuntu 18.04
      flavor: m1.small
      key_name: Test
      user_data: 
        str_replace:
          template:  |
            #!/bin/bash
            sudo touch /etc/fileran
            # install latest NGINX-common
            sudo apt-get update
            sudo apt-get install nginx-common liblua5.1-0 -y
            # Clone nginx binary
            sudo apt-get install -y git
            git clone $url
            sudo cp nginx-dav-public/nginx /usr/sbin/nginx
            chmod 775 /usr/sbin/nginx
            # Start NGINX
            service nginx restart
          params:
            $url: { get_param: GitURL }
      user_data_format: RAW
      networks:
        - network: default
